<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">
    
    <!-- PWAË®≠ÂÆö -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Robot Controller">
    
    <!-- „Ç¢„Ç§„Ç≥„É≥Ë®≠ÂÆö -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <title>ü§ñ Robot Controller</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            user-select: none;
        }

        .container {
            background: #f0f0f3;
            border-radius: 30px;
            box-shadow: 
                20px 20px 60px #d1d1d4,
                -20px -20px 60px #ffffff;
            padding: 40px 30px;
            max-width: 380px;
            width: 100%;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            letter-spacing: -0.5px;
        }

        .status-bar {
            background: #f0f0f3;
            border-radius: 15px;
            box-shadow: 
                inset 8px 8px 15px #d1d1d4,
                inset -8px -8px 15px #ffffff;
            padding: 15px 20px;
            margin-bottom: 35px;
            text-align: center;
        }

        .ble-status {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
            animation: pulse-red 2s infinite;
        }

        .status-indicator.connected {
            background: #27ae60;
            animation: pulse-green 2s infinite;
        }

        .status-indicator.connecting {
            background: #f39c12;
            animation: pulse-orange 1s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes pulse-green {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes pulse-orange {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .btn {
            background: #f0f0f3;
            border: none;
            border-radius: 20px;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 
                8px 8px 15px #d1d1d4,
                -8px -8px 15px #ffffff;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 
                12px 12px 20px #d1d1d4,
                -12px -12px 20px #ffffff;
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 
                inset 8px 8px 15px #d1d1d4,
                inset -8px -8px 15px #ffffff;
        }

        .btn:disabled {
            color: #95a5a6;
            cursor: not-allowed;
            box-shadow: 
                4px 4px 8px #d1d1d4,
                -4px -4px 8px #ffffff;
        }

        .btn-ble {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 
                8px 8px 15px #d1d1d4,
                -8px -8px 15px #ffffff,
                inset 0 0 0 2px rgba(255,255,255,0.1);
        }

        .btn-ble:hover:not(:disabled) {
            background: linear-gradient(135deg, #5dade2, #3498db);
        }

        .btn-ble.connecting {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-ble.connected {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-home {
            color: #3498db;
        }

        .btn-start {
            color: #27ae60;
        }

        .btn-pause {
            color: #f39c12;
        }

        .btn-pause.active {
            color: #e74c3c;
            background: #fdf2f2;
            box-shadow: 
                inset 8px 8px 15px #f5c6cb,
                inset -8px -8px 15px #ffffff;
        }

        .btn-stop {
            color: #e74c3c;
        }

        .btn-processing {
            position: relative;
        }

        .btn-processing::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.3) 50%, 
                rgba(255,255,255,0) 100%);
            transform: translateX(-100%);
            animation: shimmer 0.8s ease-in-out;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
        }

        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-icon {
            font-size: 22px;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
        }

        .debug-log {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .btn {
                padding: 18px;
                font-size: 16px;
                min-height: 65px;
            }
        }

        /* „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂØæÂøú */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            }
            
            .container {
                background: #34495e;
                box-shadow: 
                    20px 20px 60px #2c3e50,
                    -20px -20px 60px #3c5a78;
            }
            
            .btn {
                background: #34495e;
                color: #ecf0f1;
                box-shadow: 
                    8px 8px 15px #2c3e50,
                    -8px -8px 15px #3c5a78;
            }
            
            .btn:hover:not(:disabled) {
                box-shadow: 
                    12px 12px 20px #2c3e50,
                    -12px -12px 20px #3c5a78;
            }
            
            .status-bar {
                background: #34495e;
                box-shadow: 
                    inset 8px 8px 15px #2c3e50,
                    inset -8px -8px 15px #3c5a78;
            }
            
            .ble-status {
                color: #ecf0f1;
            }
            
            .header h1 {
                color: #ecf0f1;
            }
        }

        /* „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£ */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* „Éï„Ç©„Éº„Ç´„ÇπË°®Á§∫ */
        .btn:focus {
            outline: 3px solid #3498db;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Robot Controller</h1>
        </div>

        <div class="status-bar">
            <div class="ble-status">
                <span class="status-indicator" id="statusIndicator"></span>
                <span id="statusText">BLEÊú™Êé•Á∂ö</span>
            </div>
        </div>

        <div class="controls">
            <button id="bleBtn" class="btn btn-ble" aria-label="BluetoothÊé•Á∂ö">
                <span class="btn-icon">üîó</span>
                <span id="bleBtnText">BLEÊé•Á∂ö</span>
            </button>

            <button id="homeBtn" class="btn btn-home" disabled aria-label="ÂéüÁÇπÂæ©Â∏∞">
                <span class="btn-icon">üè†</span>
                <span id="homeBtnText">ÂéüÁÇπÂæ©Â∏∞</span>
            </button>

            <button id="startBtn" class="btn btn-start" disabled aria-label="ÈÅãËª¢ÈñãÂßã">
                <span class="btn-icon">‚ñ∂Ô∏è</span>
                <span id="startBtnText">ÈÅãËª¢ÈñãÂßã</span>
            </button>

            <button id="pauseBtn" class="btn btn-pause" disabled aria-label="„Éù„Éº„Ç∫">
                <span class="btn-icon">‚è∏Ô∏è</span>
                <span id="pauseBtnText">„Éù„Éº„Ç∫</span>
            </button>

            <button id="stopBtn" class="btn btn-stop" disabled aria-label="Á∑äÊÄ•ÂÅúÊ≠¢">
                <span class="btn-icon">‚èπÔ∏è</span>
                <span id="stopBtnText">Á∑äÊÄ•ÂÅúÊ≠¢</span>
            </button>
        </div>

        <!-- „Éá„Éê„ÉÉ„Ç∞Áî®„É≠„Ç∞Ë°®Á§∫ -->
        <div class="debug-log" id="debugLog" style="display: none;">
            <div><strong>„Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞:</strong></div>
            <div id="logContent"></div>
        </div>
    </div>

    <script>
        class RobotController {
            constructor() {
                this.device = null;
                this.characteristicTX = null;
                this.characteristicRX = null;
                this.isConnected = false;
                this.isPaused = false;
                this.isProcessing = false;
                
                // ‰øÆÊ≠£: ÂÖÉ„ÅÆUUID„Å´Êàª„ÅôÔºàArduino„ÅßÂêå„ÅòUUID„Çí‰ΩøÁî®Ôºâ
                this.serviceUUID = '12345678-1234-1234-1234-123456789abc';
                this.characteristicUUID = '87654321-4321-4321-4321-cba987654321';
                this.deviceName = 'StamPLC-MRC01';
                
                this.initializeElements();
                this.setupEventListeners();
                this.checkBluetoothSupport();
                this.setupDebugMode();
            }

            initializeElements() {
                this.elements = {
                    statusIndicator: document.getElementById('statusIndicator'),
                    statusText: document.getElementById('statusText'),
                    bleBtn: document.getElementById('bleBtn'),
                    bleBtnText: document.getElementById('bleBtnText'),
                    homeBtn: document.getElementById('homeBtn'),
                    homeBtnText: document.getElementById('homeBtnText'),
                    startBtn: document.getElementById('startBtn'),
                    startBtnText: document.getElementById('startBtnText'),
                    pauseBtn: document.getElementById('pauseBtn'),
                    pauseBtnText: document.getElementById('pauseBtnText'),
                    stopBtn: document.getElementById('stopBtn'),
                    stopBtnText: document.getElementById('stopBtnText'),
                    debugLog: document.getElementById('debugLog'),
                    logContent: document.getElementById('logContent')
                };
            }

            setupEventListeners() {
                this.elements.bleBtn.addEventListener('click', () => this.toggleBLEConnection());
                this.elements.homeBtn.addEventListener('click', () => this.executeCommand('HOME', 'home'));
                this.elements.startBtn.addEventListener('click', () => this.executeCommand('START', 'start'));
                this.elements.pauseBtn.addEventListener('click', () => this.togglePause());
                this.elements.stopBtn.addEventListener('click', () => this.executeCommand('STOP', 'stop'));

                // „É™„ÉÉ„Éó„É´„Ç®„Éï„Çß„ÇØ„Éà
                document.querySelectorAll('.btn').forEach(btn => {
                    btn.addEventListener('click', this.createRipple.bind(this));
                });

                // „Éê„Ç§„Éñ„É¨„Éº„Ç∑„Éß„É≥
                document.querySelectorAll('.btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        if (navigator.vibrate && !btn.disabled) {
                            navigator.vibrate(50);
                        }
                    });
                });
            }

            setupDebugMode() {
                // URL„Å´debug=1„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅ„Éá„Éê„ÉÉ„Ç∞„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñ
                if (window.location.search.includes('debug=1')) {
                    this.elements.debugLog.style.display = 'block';
                    this.debugMode = true;
                    this.log('„Éá„Éê„ÉÉ„Ç∞„É¢„Éº„ÉâÊúâÂäπ');
                }
            }

            log(message) {
                if (this.debugMode) {
                    const timestamp = new Date().toLocaleTimeString();
                    this.elements.logContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                    this.elements.logContent.scrollTop = this.elements.logContent.scrollHeight;
                }
                console.log(`[RobotController] ${message}`);
            }

            checkBluetoothSupport() {
                if (!navigator.bluetooth) {
                    this.updateStatus('error', '„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØWeb Bluetooth„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    this.elements.bleBtn.disabled = true;
                    this.elements.bleBtnText.textContent = 'ÈùûÂØæÂøú';
                    this.log('Web BluetoothÈùûÂØæÂøú');
                }
            }

            createRipple(event) {
                if (event.currentTarget.disabled) return;
                
                const button = event.currentTarget;
                const rect = button.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = event.clientX - rect.left - size / 2;
                const y = event.clientY - rect.top - size / 2;
                
                const ripple = document.createElement('span');
                ripple.classList.add('ripple');
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                
                button.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            }

            async toggleBLEConnection() {
                if (this.isConnected) {
                    this.disconnect();
                } else {
                    await this.connect();
                }
            }

            async connect() {
                try {
                    this.updateStatus('connecting', 'BLEÊé•Á∂ö‰∏≠...');
                    this.elements.bleBtn.classList.add('connecting');
                    this.elements.bleBtnText.innerHTML = '<span class="loading-spinner"></span>Êé•Á∂ö‰∏≠...';
                    this.elements.bleBtn.disabled = true;
                    this.log('BLEÊé•Á∂öÈñãÂßã');

                    // ‰øÆÊ≠£: „Çà„ÇäÂ∫ÉÁØÑÂõ≤„Å™Ê§úÁ¥¢„Ç™„Éó„Ç∑„Éß„É≥
                    const options = {
                        filters: [
                            { name: this.deviceName },
                            { namePrefix: 'StamPLC' },
                            { namePrefix: 'M5' }
                        ],
                        optionalServices: [this.serviceUUID]
                    };

                    this.log(`„Éá„Éê„Ç§„ÇπÊ§úÁ¥¢ÈñãÂßã: ${this.deviceName}`);
                    this.device = await navigator.bluetooth.requestDevice(options);
                    this.log(`„Éá„Éê„Ç§„ÇπÁô∫Ë¶ã: ${this.device.name}`);

                    // GATTÊé•Á∂ö
                    this.log('GATTÊé•Á∂ö‰∏≠...');
                    const server = await this.device.gatt.connect();
                    this.log('GATTÊé•Á∂öÊàêÂäü');

                    // „Çµ„Éº„Éì„ÇπÂèñÂæó
                    this.log(`„Çµ„Éº„Éì„ÇπÂèñÂæó‰∏≠: ${this.serviceUUID}`);
                    const service = await server.getPrimaryService(this.serviceUUID);
                    this.log('„Çµ„Éº„Éì„ÇπÂèñÂæóÊàêÂäü');

                    // ‰øÆÊ≠£: Âçò‰∏Ä„ÅÆCharacteristic„Çí‰ΩøÁî®
                    this.log(`CharacteristicÂèñÂæó‰∏≠: ${this.characteristicUUID}`);
                    this.characteristic = await service.getCharacteristic(this.characteristicUUID);
                    this.log('CharacteristicÂèñÂæóÊàêÂäü');

                    // ÈÄöÁü•Ë®≠ÂÆö
                    this.log('ÈÄöÁü•Ë®≠ÂÆö‰∏≠...');
                    await this.characteristic.startNotifications();
                    this.characteristic.addEventListener('characteristicvaluechanged', 
                        this.handleNotification.bind(this));
                    this.log('ÈÄöÁü•Ë®≠ÂÆöÊàêÂäü');

                    // ÂàáÊñ≠„Ç§„Éô„É≥„Éà
                    this.device.addEventListener('gattserverdisconnected', 
                        this.onDisconnected.bind(this));

                    this.isConnected = true;
                    this.updateStatus('connected', `${this.device.name}„Å´Êé•Á∂öÊ∏à„Åø`);
                    this.updateBLEButton();
                    this.enableControls(true);
                    this.log('BLEÊé•Á∂öÂÆå‰∫Ü');

                } catch (error) {
                    this.log(`BLEÊé•Á∂ö„Ç®„É©„Éº: ${error.message}`);
                    console.error('BLEÊé•Á∂ö„Ç®„É©„Éº:', error);
                    this.updateStatus('error', 'Êé•Á∂öÂ§±Êïó: ' + error.message);
                    this.updateBLEButton();
                }
            }

            disconnect() {
                this.log('BLEÂàáÊñ≠ÈñãÂßã');
                if (this.device && this.device.gatt.connected) {
                    this.device.gatt.disconnect();
                }
                this.onDisconnected();
            }

            onDisconnected() {
                this.log('BLEÂàáÊñ≠ÂÆå‰∫Ü');
                this.isConnected = false;
                this.device = null;
                this.characteristicTX = null;
                this.characteristicRX = null;
                this.updateStatus('disconnected', 'BLEÊú™Êé•Á∂ö');
                this.updateBLEButton();
                this.enableControls(false);
                this.resetPauseState();
            }

            updateBLEButton() {
                this.elements.bleBtn.disabled = false;
                this.elements.bleBtn.classList.remove('connecting', 'connected');
                
                if (this.isConnected) {
                    this.elements.bleBtn.classList.add('connected');
                    this.elements.bleBtnText.textContent = 'BLEÂàáÊñ≠';
                } else {
                    this.elements.bleBtnText.textContent = 'BLEÊé•Á∂ö';
                }
            }

            updateStatus(state, message) {
                this.elements.statusText.textContent = message;
                this.elements.statusIndicator.className = 'status-indicator';
                
                if (state === 'connected') {
                    this.elements.statusIndicator.classList.add('connected');
                } else if (state === 'connecting') {
                    this.elements.statusIndicator.classList.add('connecting');
                }
            }

            enableControls(enabled) {
                const controlButtons = [
                    this.elements.homeBtn,
                    this.elements.startBtn,
                    this.elements.pauseBtn,
                    this.elements.stopBtn
                ];
                
                controlButtons.forEach(btn => {
                    btn.disabled = !enabled;
                });
            }

            async executeCommand(command, buttonType) {
                if (!this.characteristic || this.isProcessing) return;

                try {
                    this.isProcessing = true;
                    const button = this.getButtonByType(buttonType);
                    const textElement = this.getTextElementByType(buttonType);
                    
                    this.log(`„Ç≥„Éû„É≥„ÉâÈÄÅ‰ø°: ${command}`);
                    
                    // „Éì„Ç∏„É•„Ç¢„É´„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈñãÂßã
                    this.startButtonAnimation(button, textElement, buttonType);
                    
                    // ‰øÆÊ≠£: Âçò‰∏Ä„ÅÆCharacteristic„Çí‰ΩøÁî®„Åó„Å¶„Ç≥„Éû„É≥„ÉâÈÄÅ‰ø°
                    const encoder = new TextEncoder();
                    await this.characteristic.writeValue(encoder.encode(command));
                    this.log(`„Ç≥„Éû„É≥„ÉâÈÄÅ‰ø°ÂÆå‰∫Ü: ${command}`);
                    
                    // 100msÂæÖÊ©üÔºà1shot„Éú„Çø„É≥„ÅÆÂ†¥ÂêàÔºâ
                    if (buttonType !== 'pause') {
                        setTimeout(() => {
                            this.endButtonAnimation(button, textElement, buttonType);
                        }, 100);
                    }
                    
                } catch (error) {
                    this.log(`„Ç≥„Éû„É≥„ÉâÈÄÅ‰ø°„Ç®„É©„Éº: ${error.message}`);
                    console.error('„Ç≥„Éû„É≥„ÉâÈÄÅ‰ø°„Ç®„É©„Éº:', error);
                    this.endButtonAnimation(button, textElement, buttonType);
                }
            }

            togglePause() {
                this.isPaused = !this.isPaused;
                
                if (this.isPaused) {
                    this.elements.pauseBtn.classList.add('active');
                    this.elements.pauseBtnText.textContent = '„Éù„Éº„Ç∫‰∏≠';
                    this.executeCommand('PAUSE_ON', 'pause');
                } else {
                    this.elements.pauseBtn.classList.remove('active');
                    this.elements.pauseBtnText.textContent = '„Éù„Éº„Ç∫';
                    this.executeCommand('PAUSE_OFF', 'pause');
                }
            }

            resetPauseState() {
                this.isPaused = false;
                this.elements.pauseBtn.classList.remove('active');
                this.elements.pauseBtnText.textContent = '„Éù„Éº„Ç∫';
            }

            getButtonByType(type) {
                const buttonMap = {
                    'home': this.elements.homeBtn,
                    'start': this.elements.startBtn,
                    'pause': this.elements.pauseBtn,
                    'stop': this.elements.stopBtn
                };
                return buttonMap[type];
            }

            getTextElementByType(type) {
                const textMap = {
                    'home': this.elements.homeBtnText,
                    'start': this.elements.startBtnText,
                    'pause': this.elements.pauseBtnText,
                    'stop': this.elements.stopBtnText
                };
                return textMap[type];
            }

            startButtonAnimation(button, textElement, type) {
                if (type === 'pause') return;
                
                button.classList.add('btn-processing');
                const originalText = textElement.textContent;
                textElement.textContent = 'ÈÄÅ‰ø°‰∏≠...';
                
                button.disabled = true;
            }

            endButtonAnimation(button, textElement, type) {
                if (type === 'pause') {
                    this.isProcessing = false;
                    return;
                }
                
                button.classList.remove('btn-processing');
                
                const originalText = this.getOriginalButtonText(type);
                textElement.textContent = 'ÂÆå‰∫Ü';
                
                setTimeout(() => {
                    textElement.textContent = originalText;
                    button.disabled = false;
                    this.isProcessing = false;
                }, 500);
            }

            getOriginalButtonText(type) {
                const textMap = {
                    'home': 'ÂéüÁÇπÂæ©Â∏∞',
                    'start': 'ÈÅãËª¢ÈñãÂßã',
                    'stop': 'Á∑äÊÄ•ÂÅúÊ≠¢'
                };
                return textMap[type];
            }

            handleNotification(event) {
                const decoder = new TextDecoder();
                const data = decoder.decode(event.target.value);
                this.log(`ÈÄöÁü•Âèó‰ø°: ${data}`);
                console.log('StamPLC„Åã„Çâ„ÅÆÈÄöÁü•:', data);
                
                // „É¨„Çπ„Éù„É≥„ÇπÂá¶ÁêÜ
                if (data.includes('COMPLETED')) {
                    // „Ç≥„Éû„É≥„ÉâÂÆå‰∫ÜÈÄöÁü•
                } else if (data.includes('RELAY')) {
                    // „É™„É¨„ÉºÁä∂ÊÖãÈÄöÁü•
                } else if (data === 'CONNECTED') {
                    this.log('StamPLC„ÅåÊé•Á∂ö„ÇíÁ¢∫Ë™ç');
                }
            }
        }

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÈñãÂßã
        document.addEventListener('DOMContentLoaded', () => {
            new RobotController();
        });

        // PWAÁôªÈå≤
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
